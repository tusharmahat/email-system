var currPage = window.location.href;
function navSwipe() {
  $("#check").is(":checked")
    ? ($(".menu-m ul").css("left", "35px"),
      $(".menu-m ul").css("transition", "all 0.5s"))
    : ($(".menu-m ul").css("left", "-100%"),
      $(".menu-m ul").css("transition", "all 0.5s"));
}
function isScreenSmall() {
  return window.matchMedia("(max-width: 768px)");
}
function activateTab(e, n) {
  var a = document.getElementsByClassName(n);
  a.length > 0 &&
    (e.match("inbox") || e.match("home")
      ? (a[0].className += " active")
      : e.match("sent")
      ? (a[1].className += " active")
      : e.match("fav")
      ? (a[2].className += " active")
      : e.match("unread")
      ? (a[3].className += " active")
      : e.match("deleted") && (a[4].className += " active"));
}
function confirmDelete(e, n) {
  return !!confirm(`Are you sure want to delete ${e} ${n}?`);
}
function showCompose() {
  $("#select-mail-ins").css("display", "none"),
    $(".input-group input").val(""),
    $("#send-msg").val(""),
    $("#email--view").css("display", "none"),
    $("#compose").css("display", "block");
}
function sendConfirm() {
  $("#send-alert").modal();
}
function validate() {
  return (
    !!(
      $("#send-check-1").is(":checked") &&
      $("#send-check-2").is(":checked") &&
      $("#send-check-3").is(":checked") &&
      $("#send-check-4").is(":checked") &&
      $("#send-check-5").is(":checked")
    ) ||
    ($("#help-yellow").css("background-color", "#FFC107"),
    $("#btn-no").on("click", () => {
      $("#help-yellow").css("background-color", "#fafad2");
    }),
    !1)
  );
}
function back() {
  if (!isScreenSmall().matches)
    return (
      !!confirm("Are you sure want to cancel, and go back?") &&
      ($("#compose").css("display", "none"),
      $("#email--view").css("display", "none"),
      $("#select-mail-ins").css("display", "block"),
      !0)
    );
}
function helpGenerate(e) {
  var n, a;
  "none" === $("#help-appear").css("display") && $("#help-appear").remove(),
    "subject" == e &&
      ((n = "Subject Line"),
      (a =
        '<p>\n      Write a few words that describes the general idea of what your email is about.\n      But beware of making your subject line too long.<br><br>\n  </p>\n  \n  <p class="help-ex" onclick="showMore(\'subject\')">\n      <b>Click here for examples of Subject Line:</b><br>\n      <a onclick="showMore(\'subject\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>')),
    "to" == e &&
      ((n = "Recipient Line"),
      (a =
        ' <p>\n      Write the email address of the person to whom you want to send the email.\n      <br><br>\n  </p>\n  \n  <p class="help-ex" onclick="showMore(\'to\')">\n      <b> Click here for examples of an email recipient:</b><br>\n      <a onclick="showMore(\'to\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>')),
    "cc" == e &&
      ((n = "Carbon Copy"),
      (a =
        '<p>\n      Write the email address of the person to whom you want to send this copy of the email to.\n      <br><br>\n  </p>\n  \n  <p class="help-ex" onclick="showMore(\'cc\')">\n      <b> Click here for examples of a Cc:</b><br>\n      <a onclick="showMore(\'cc\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>\n  \n  ')),
    "greeting" == e &&
      ((n = "Greetings"),
      (a =
        '<p>\n      Write a word or couple of words to show a sign of welcome or recognition to the person you\n      are\n      sending this email to.<br><br>\n  </p>\n  \n  <p class="help-ex" onclick="showMore(\'greeting\')">\n      <b>Click here for examples of greetings:</b><br>\n      <a onclick="showMore(\'greeting\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>')),
    "message" == e &&
      ((n = "Introduction/Body"),
      (a =
        ' <p>\n      With short introduction about yourself, write your message in this section.\n      <br>It should consist of detailed and clear content as your email recipient would not\n      misunderstand any of your important points and gets the actual message you are trying to\n      convey.<br><br>\n  </p>\n  <p class="help-ex" onclick="showMore(\'message\')">\n      <b>Click here for examples of Messages:</b><br>\n      <a onclick="showMore(\'message\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>')),
    "closing" == e &&
      ((n = "Closing"),
      (a =
        '<p>\n      Write a word or couple of words that may provide a good last impression.<br>\n      Its better if you include your full name, contact information, and title (if appropriate) as\n      shown in the example when you click the more icon.\n      <br><br>\n  </p>\n  \n  <p class="help-ex" onclick="showMore(\'closing\')">\n      <b>Click here for examples of Closings:</b><br>\n      <a onclick="showMore(\'closing\')"><i class="icon fas fa-caret-right"></i></a>\n  </p>')),
    "example" == e &&
      ((n = "Example"),
      (a =
        "Dear April,<br><br>\n  \n      My name is Leslie and I’m a park director with the Indiana Parks and Recreation Department. We’re dedicated to making Indiana parks more beautiful and visitor-friendly.<br><br>\n      \n      I’m reaching out today to see if you would be interested in learning more about our summer initiative to get more kids outside and to the parks. \n      I know you run a summer camp, and I’d love to talk about partnering with you to use our parks for certain outdoor activities.<br><br>\n      \n      Let me know if you’d like to learn more.<br><br>\n      \n      Sincerely,<br>\n      Leslie Knope<br>\n      Park Director, Indiana Parks<br>\n      April_Knope@hotmail.com<br>\n      (555) 555-6546")),
    "help" == e &&
      ((n = "Help"),
      (a =
        '\n      <p class="help-menu"><i class="icon far fa-envelope"></i> >> List of received emails</p>\n      <p class="help-menu"><i class="icon far fa-paper-plane"></i> >> List of sent emails</p>\n      <p class="help-menu"><i class="icon far fa-heart"></i> >> List of emails added to favorite</p>\n      <p class="help-menu"><i class="icon fas fa-mail-bulk"></i> >> List of unread emails</p>\n      <p class="help-menu"><i class="icon-fav far fa-star"></i> >> is a favorite email, click to remove it from favorite</p>\n      <p class="help-menu"><i class="far fa-star"></i> >> is not a favorite email, click on it to add to favorite</p>\n      <p class="help-menu"><i class="far fa-times-circle"></i> >> deletes a particular email</p>\n      <p class="help-menu"><i class="fas fa-trash-alt"></i> >> deletes all emails in the box</p>\n      <p class="help-menu"><img class="icon icon--no-margin" src="../images/search.png"> >> Search a particular email using the email address</p>\n      <p class="help-menu help--yellow"><span class="unread">Emily_Francis@hotmail.com<span> >> Unread email </p>\n      <p class="help-menu help--yellow">Emily_Francis@hotmail.com >> Read email</p>\n      <p class="help-menu"><img class="icon--no-margin" src="../images/storage.png" alt=""> >> Storage between 0 to 95%</p>\n      <p class="help-menu"><img class="icon--no-margin" src="../images/storage-danger.png" alt=""> >> Storage 95% or more</p>')),
    showHelp(n, a);
}
function showHelp(e, n) {
  var a = `<div class="modal fade" id="help-appear" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"\n    style="display: none">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 class="modal-title" id="exampleModalLabel">\n                    ${e}\n                </h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                    <span aria-hidden="true">×</span>\n                </button>\n            </div>\n            <div class="modal-bod">\n            ${n}          </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                    Close\n                </button>\n            </div>\n        </div>\n    </div>\n  </div>`;
  $("body").append(a), $("#help-appear").modal();
}
function showMore(e) {
  var n;
  "subject" == e &&
    ("Subject Line",
    (n =
      "<p><b>A Formal example email of the subject line:</b><br>\n      <i>Required Student Meeting: December 5th, 9:30 a.m</i></p>\n      <br>\n  <p>\n      <b>An informal example email of the subject line:</b><br>\n      <i>Upcoming Meeting</i>\n  </p>\n  <br>\n  <p>\n      Notice that the first subject line is more informative and complete. The informal subject\n      line, sent to someone you know well, just barely touches on the topic.\n  </p><a onclick=\"helpGenerate('subject')\">Back</a>")),
    "to" == e &&
      ("Recipient Line",
      (n =
        "<p><b>Examples of email address:</b><br><i>Emily_Clarke99@gmail.com<br>James.Hall2020@gmail.com</i></p><br>\n  <p><b>Email address names can include the following:</b>\n      <br>\n      Uppercase and lowercase letters: A-Z and a-z.<br>\n      Digits: 0-9.<br>\n  </p>\n  ")),
    "cc" == e &&
      ("Carbon Copy",
      (n =
        ' <i>To: LucasBalotelli@gmail.com, <br> Cc: Ana.Gomes@icloud.com,\n          Carl_Henry11@gmail.com</i><br><br>\n  </p>\n  <p>\n      You can add more recipients by separating the emails by <b>","</b>.\n  </p>\n  \n  ')),
    "greeting" == e &&
      ("Greetings",
      (n =
        "\n  <p>\n      <i>Dear/Hi Shawn, Respected Professor Robert, Hello everyone</i></p>\n  <br>\n  \n  <p>\n      It is more preferred when you use the name of the person you are sending the email to.\n  </p>\n  <br>\n  \n  <p>\n      <b> Here’s an example of a formal greeting with the job title of the person but without\n          their\n          name: </b><br>\n      <i>Dear Human Resources Director, Respected Manager of Tim Hortons</i>\n  </p>\n  <br>\n  <p>\n      <b> In rare instances where you don’t know a person’s name or title, it’s okay to use this\n          greeting: </b><br>\n      <i>To whom it may concern,</i><br>\n  </p>")),
    "message" == e &&
      ("Introduction/Body",
      (n =
        "<p><i>My name is Jordan Smith. I am the professor of Statistics for Saint Mary's University.\n          This\n          message is for all students enrolled in this course.</i></p><br>\n  After the introduction write your message.\n  ")),
    "closing" == e &&
      ("Closing",
      (n =
        "<p><b>Closing sample:</b><br>\n      <i>Sincerely with kind regards,<br>\n          Jordan Smith<br>\n          Professor of Computer Science, York College<br>\n          jordan.smith7@gmail.com<br>\n          (902)345-6789<br>\n      </i><br>\n      <b>Other examples of closing words that you could use are: </b>\n      <br>\n      <i>Best Regards, Warm Wishes, Many Thanks, With gratitude.</i>\n  </p>\n  ")),
    "example" == e &&
      ("Example",
      (n =
        "Dear April,<br><br>\n  \n      My name is Leslie and I’m a park director with the Indiana Parks and Recreation Department. We’re dedicated to making Indiana parks more beautiful and visitor-friendly.<br><br>\n      \n      I’m reaching out today to see if you would be interested in learning more about our summer initiative to get more kids outside and to the parks. \n      I know you run a summer camp, and I’d love to talk about partnering with you to use our parks for certain outdoor activities.<br><br>\n      \n      Let me know if you’d like to learn more.<br><br>\n      \n      Sincerely,<br>\n      Leslie Knope<br>\n      Park Director, Indiana Parks<br>\n      April_Knope@hotmail.com<br>\n      (555) 555-6546")),
    $(".modal-bod").html(n);
}
$(document).ready(function () {
  $.fn.scrollDivToElement = function (e) {
    return this.length
      ? this.each(function () {
          let n = $(this),
            a = n.find(e);
          a.length > 0 &&
            n.scrollTop(
              n.scrollTop() -
                n.offset().top +
                a.offset().top -
                n.outerHeight() / 2 +
                a.outerHeight() / 2
            );
        })
      : this;
  };
  var e = currPage.split("-");
  isScreenSmall().matches
    ? activateTab(currPage, "tab-m")
    : ($("#middle").scrollDivToElement(`.view-${e[1]}`),
      activateTab(currPage, "tab")),
    $(function () {
      currPage.match("home") &&
        fetch("/users/unread-count")
          .then((e) => e.json())
          .then((e) => {
            e.count > 0 &&
              ($(".menu-m ul").css("left", "35px"),
              confirm(
                `You have ${e.count} unread emails, Do you want to read them now?`
              ) && (window.location.href = e.url));
          });
    }),
    1 == $("#email--view").parents("#right").length &&
      ($("#middle-m").css("display", "none"),
      $("#right").css("display", "block")),
    0 == $("#middle").children().length &&
      $("#middle").html('<p class="help--yellow">No emails</p>'),
    0 == $("#middle-m").children().length &&
      $("#middle-m").html('<p class="help--yellow">No emails</p>'),
    $(".btn-compose").on("click", () => {
      isScreenSmall().matches &&
        ($("#middle-m").css("display", "none"),
        $("#right").css("display", "block"),
        $(".menu-m ul").css("left", "-100%"));
    }),
    $(".btn-back").on("click", () => {
      isScreenSmall().matches &&
        ($("#right").css("display", "none"),
        $("#middle-m").css("display", "block"));
    });
}),
  $(".text-search").keyup(function () {
    var e = $(this).val();
    if ("" !== e) {
      var n = "";
      (n = currPage.includes("inbox")
        ? "inbox"
        : currPage.includes("sent")
        ? "sent"
        : "deleted"),
        fetch(`/search/${n}`)
          .then((e) => e.json())
          .then((a) => {
            var i = new RegExp(e, "i"),
              o = "",
              s = 0;
            $.each(a, function (e, a) {
              (-1 == a.from.search(i) &&
                -1 == a.to.search(i) &&
                -1 == a.sb.search(i)) ||
                (o += `<div class="view">${
                  "inbox" == n
                    ? `<form class="btn-fav" action="/users/${n}/add-to-fav/${s}" method="POST">\n          <button type="submit">\n            <i\n              class="icon${
                        1 == a.fav ? " icon-fav" : ""
                      } far fa-star"\n            ></i>\n          </button>\n        </form>`
                    : ""
                }\n          <a href="/${n}/-${s}"\n            ><label class="list-mail">\n              <label\n                id="view"\n                name="view"\n                class="${
                  "inbox" != n ? "" : "unread"
                }${
                  1 != a.read ? "" : "unread"
                }"\n              >\n              ${
                  "inbox" == n ? a.from : a.to
                } </label\n              >\n              <label data-role="button" class="list-sb">${
                  a.sb
                }</label></label\n            ></a\n          >\n          <form\n            class="btn-delete"\n            action="/users/${n}/delete-one/${s}"\n            method="POST"\n            onsubmit="return confirmDelete('this','email')"\n          >\n            <button type="submit">\n              <i class="icon far fa-times-circle"></i>\n            </button>\n          </form>\n        </div>`),
                s++;
            }),
              (o += "</div>"),
              $(".view").remove(),
              $("#middle").append(o),
              $("#middle-m").append(o);
          });
    } else $("#filter-records").html("");
  });
